<div id="group-card-{{ forloop.counter }}" class="col-md-4">
    <div class="card bg-gray-800 border-gray-700 shadow-lg h-100">
        <div class="card-header bg-gray-700 border-gray-600">
            <h5 class="mb-0 text-white">{{ group.name }}</h5>
            <small class="text-gray-400">VDOT: {{ group.vdot }}</small>
        </div>
        <div class="card-body">
            <form hx-post="{% url 'recalculate-plan' %}"
                  hx-trigger="change from:.recalc-trigger"
                  hx-target="#group-card-{{ forloop.counter }}"
                  hx-swap="outerHTML">

                <input type="hidden" name="group_name" value="{{ group.name }}">
                <input type="hidden" name="group_vdot" value="{{ group.vdot }}">
                <input type="hidden" name="forloop_counter" value="{{ forloop.counter }}">

                <table class="table table-borderless table-sm text-gray-300 align-middle">
                    <thead>
                        <tr class="text-gray-400">
                            <th scope="col">Segment</th>
                            <th scope="col" class="text-center">Pace</th>
                            <th scope="col" class="text-center">400m Lap</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for segment in group.workout %}
                        <tr>
                            <td class="w-50">
                                <!-- Reps and Distance -->
                                <div class="input-group input-group-sm">
                                    <input type="number" name="reps" value="{{ segment.reps }}" class="form-control bg-gray-700 border-gray-600 text-white focus:bg-gray-600 focus:border-blue-500 focus:ring-blue-500 recalc-trigger" style="max-width: 55px;">
                                    <span class="input-group-text bg-gray-700 border-gray-600 text-white">x</span>
                                    <select name="distance" class="form-select bg-gray-700 border-gray-600 text-white focus:bg-gray-600 focus:border-blue-500 focus:ring-blue-500 recalc-trigger">
                                        <option value="200" {% if segment.distance == '200' %}selected{% endif %}>200m</option>
                                        <option value="400" {% if segment.distance == '400' %}selected{% endif %}>400m</option>
                                        <option value="600" {% if segment.distance == '600' %}selected{% endif %}>600m</option>
                                        <option value="800" {% if segment.distance == '800' %}selected{% endif %}>800m</option>
                                        <option value="1000" {% if segment.distance == '1000' %}selected{% endif %}>1000m</option>
                                        <option value="1200" {% if segment.distance == '1200' %}selected{% endif %}>1200m</option>
                                        <option value="1600" {% if segment.distance == '1600' %}selected{% endif %}>1600m</option>
                                    </select>
                                </div>
                                <!-- Intensity and Rest -->
                                <div class="input-group input-group-sm mt-1">
                                    <select name="intensity" class="form-select bg-gray-700 border-gray-600 text-white focus:bg-gray-600 focus:border-blue-500 focus:ring-blue-500 recalc-trigger">
                                        <option {% if segment.intensity == 'Repetition' %}selected{% endif %}>Repetition</option>
                                        <option {% if segment.intensity == 'Interval' %}selected{% endif %}>Interval</option>
                                        <option {% if segment.intensity == 'Threshold' %}selected{% endif %}>Threshold</option>
                                    </select>
                                    <input type="number" name="rest" value="{{ segment.rest }}" class="form-control bg-gray-700 border-gray-600 text-white focus:bg-gray-600 focus:border-blue-500 focus:ring-blue-500 recalc-trigger" placeholder="Rest (s)">
                                    <span class="input-group-text bg-gray-700 border-gray-600 text-white">s</span>
                                </div>
                            </td>
                            <td class="text-center font-monospace">{{ segment.target_pace }}</td>
                            <td class="text-center font-monospace">{{ segment.lap_time }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </form>
        </div>
        <div class="card-footer bg-gray-700 border-gray-600">
            <ul class="list-unstyled mb-0 small text-gray-300">
                <li class="d-flex justify-content-between"><span>Total Distance:</span> <strong>{{ group.summary.distance }}</strong></li>
                <li class="d-flex justify-content-between"><span>Active Time:</span> <strong>{{ group.summary.active_time }}</strong></li>
                <li class="d-flex justify-content-between"><span>Total Time (inc. rest):</span> <strong>{{ group.summary.total_time }}</strong></li>
                <li class="d-flex justify-content-between"><span>Predicted TSS:</span> <strong>{{ group.summary.tss }}</strong></li>
            </ul>
        </div>
    </div>
</div>

